<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta charset="utf-8">
    
    
    
    <title>Spring Security based on Spring Boot | 个人空间</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    
    <meta name="theme-color" content="#77AAFF">
    
    
    <meta name="keywords" content="">
    
    

    

    <!-- Baidu Push -->
<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();

	var _hmt = _hmt || [];
</script>



    
    <meta name="description" content="Welcome to Wuwei`Blog Spring Security based on Spring Boot 一 基础篇Spring security 是什么？&amp;emsp;&amp;emsp;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，D">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Security based on Spring Boot">
<meta property="og:url" content="http://yoursite.com/2018/03/14/spring-security/index.html">
<meta property="og:site_name" content="个人空间">
<meta property="og:description" content="Welcome to Wuwei`Blog Spring Security based on Spring Boot 一 基础篇Spring security 是什么？&amp;emsp;&amp;emsp;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，D">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://p4ucv3uvl.bkt.clouddn.com/blog/DaoAuthenticationProvider.png">
<meta property="og:image" content="http://p4ucv3uvl.bkt.clouddn.com/blog/blog/structure.png">
<meta property="og:image" content="http://p4ucv3uvl.bkt.clouddn.com/blog/WebSecurityConfigurerAdapter.png">
<meta property="og:image" content="http://p4ucv3uvl.bkt.clouddn.com/blog/HttpSecurity.png">
<meta property="og:updated_time" content="2018-03-14T15:31:17.836Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Security based on Spring Boot">
<meta name="twitter:description" content="Welcome to Wuwei`Blog Spring Security based on Spring Boot 一 基础篇Spring security 是什么？&amp;emsp;&amp;emsp;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，D">
<meta name="twitter:image" content="http://p4ucv3uvl.bkt.clouddn.com/blog/DaoAuthenticationProvider.png">
    
        <link rel="alternate" type="application/atom+xml" title="个人空间" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link id="style" rel="stylesheet" href="/css/style.css?v=3.0">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    
            
</head>

<body>
    <div id="loading" class="active"></div>
    <aside id="menu"  class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" >
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/picture.jpg" alt="avatar">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname" id="name">joke</h5>
          
            <div id="yiyanmotto" class="motto">&nbsp;</div>
          
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
              <li class="waves-block waves-effect">
                  <a href="/"  >
                    <i class="icon icon-lg icon-home"></i>
                    <span>主 页</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/archives"  >
                    <i class="icon icon-lg icon-archives"></i>
                    <span>归 档</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/categories"  >
                    <i class="icon icon-lg icon-th-list"></i>
                    <span>分 类</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/tags"  >
                    <i class="icon icon-lg icon-tags"></i>
                    <span>标 签</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
              <li class="waves-block waves-effect">
                  <a href="/resume"  >
                    <i class="icon icon-lg icon-smile-o"></i>
                    <span>关 于</span><i class="icon icon-lg icon-caret-left"></i>
                  </a>
              </li>
            
      <div class="nav2">
          
              <a class="nav2item" data-title="Email" href="/hou0608@aliyun.com" target="_parent"title="Email" >
                <i class="icon icon-lg icon-envelope-o envelope-o"></i>
              </a>
          
              <a class="nav2item" data-title="Github" href="https://github.com/hou68" target="_blank"title="Github" >
                <i class="icon icon-lg icon-github github"></i>
              </a>
          
              <a class="nav2item" data-title="微博" href="https://weibo.com/u/1854475461/home?wvr=57" target="_blank"title="微博" >
                <i class="icon icon-lg icon-weibo weibo"></i>
              </a>
          

            </div>
        
      </ul>
        
    </div>
  </div>
 
</aside>


    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Spring Security based on Spring Boot</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        <a href="../../atom.xml" target="_blank" class="header-icon waves-effect waves-circle waves-light" id="Rss">
            <i class="icon icon-lg icon-rss"></i>
        </a>
    </div>
</header>
<header class="content-header post-header">
    
    
    <div class="container fade-scale">
        <div id="myheader">
            <h1 class="title">
                
            </h1>
            <h5 class="subtitle">
                
                
            </h5>
        </div>
    </div>

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Spring-Security-based-on-Spring-Boot"><span class="post-toc-number">1.</span> <span class="post-toc-text">Spring Security based on Spring Boot</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一-基础篇"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">一 基础篇</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Spring-security-是什么？"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">Spring security 是什么？</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原理"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">原理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分类"><span class="post-toc-number">1.1.3.</span> <span class="post-toc-text">分类:</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#核心组件"><span class="post-toc-number">1.1.4.</span> <span class="post-toc-text">核心组件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-SecurityContextHolder"><span class="post-toc-number">1.1.4.1.</span> <span class="post-toc-text">1 SecurityContextHolder</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#1-1-获取当前用户的信息"><span class="post-toc-number">1.1.4.1.1.</span> <span class="post-toc-text">1.1 获取当前用户的信息</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#说明"><span class="post-toc-number">1.1.4.1.2.</span> <span class="post-toc-text">说明</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-Authentication"><span class="post-toc-number">1.1.4.2.</span> <span class="post-toc-text">2 Authentication</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Spring-Security-身份验证"><span class="post-toc-number">1.1.5.</span> <span class="post-toc-text">Spring Security 身份验证</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#认证过程"><span class="post-toc-number">1.1.5.1.</span> <span class="post-toc-text">认证过程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#说明-1"><span class="post-toc-number">1.1.5.1.1.</span> <span class="post-toc-text">说明</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注意："><span class="post-toc-number">1.1.5.1.2.</span> <span class="post-toc-text">注意：</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-AuthenticationManager"><span class="post-toc-number">1.1.5.2.</span> <span class="post-toc-text">3 AuthenticationManager</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-1-DaoAuthenticationProvider"><span class="post-toc-number">1.1.5.2.1.</span> <span class="post-toc-text">3.1 DaoAuthenticationProvider</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#3-2-UserDetails与UserDetailsService"><span class="post-toc-number">1.1.5.2.2.</span> <span class="post-toc-text">3.2 UserDetails与UserDetailsService</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-整体架构图"><span class="post-toc-number">1.1.5.3.</span> <span class="post-toc-text">4 整体架构图</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二-代码篇"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">二 代码篇</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#核心配置"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">核心配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#说明-2"><span class="post-toc-number">1.2.1.0.1.</span> <span class="post-toc-text">说明</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#注解-EnableWebSecurity"><span class="post-toc-number">1.2.1.1.</span> <span class="post-toc-text">注解 @EnableWebSecurity</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WebSecurityConfiguration"><span class="post-toc-number">1.2.1.2.</span> <span class="post-toc-text">WebSecurityConfiguration</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AuthenticationConfiguration"><span class="post-toc-number">1.2.1.3.</span> <span class="post-toc-text">AuthenticationConfiguration</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WebSecurityConfigurerAdapter"><span class="post-toc-number">1.2.1.4.</span> <span class="post-toc-text">WebSecurityConfigurerAdapter</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#HttpSecurity常用配置"><span class="post-toc-number">1.2.1.4.1.</span> <span class="post-toc-text">HttpSecurity常用配置</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#WebSecurityBuilder"><span class="post-toc-number">1.2.1.5.</span> <span class="post-toc-text">WebSecurityBuilder</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AuthenticationManagerBuilder"><span class="post-toc-number">1.2.1.6.</span> <span class="post-toc-text">AuthenticationManagerBuilder</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三-高级篇"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">三 高级篇</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原理-1"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Servlet"><span class="post-toc-number">1.3.1.1.</span> <span class="post-toc-text">Servlet</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Spring-Security"><span class="post-toc-number">1.3.1.2.</span> <span class="post-toc-text">Spring Security</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四-使用-Spring-Security"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">四 使用 Spring Security</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Spring-Boot-使用-Spring-Security"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">Spring Boot 使用 Spring Security</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#相关参考网址"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">相关参考网址</span></a></li></ol></li></ol>
        </nav>
    </aside>
   
<article id="post-spring-security"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Spring Security based on Spring Boot</h1>
        <div class="post-meta">
            <i class="icon icon-lg icon-calendar-o"></i>
            发表于
            <time class="post-time" title="2018-03-14 23:28:22" datetime="2018-03-14T15:28:22.677Z"  itemprop="datePublished">2018-03-14</time>

            <br id="mybreak"/>
            
<script>
	mybreak.style="display:none";
</script>


            <i>·</i>
            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>次浏览
</span>


        </div>
        <div class="post-count-custom">
            <i class="icon icon-lg icon-comment-o"></i>
            阅读本文可能花费您&nbsp;<span class="post-count">24</span>&nbsp;分钟
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>Welcome to Wuwei`Blog</p>
<h1 id="Spring-Security-based-on-Spring-Boot"><a href="#Spring-Security-based-on-Spring-Boot" class="headerlink" title="Spring Security based on Spring Boot"></a>Spring Security based on Spring Boot</h1><hr>
<h2 id="一-基础篇"><a href="#一-基础篇" class="headerlink" title="一 基础篇"></a>一 基础篇</h2><h3 id="Spring-security-是什么？"><a href="#Spring-security-是什么？" class="headerlink" title="Spring security 是什么？"></a>Spring security 是什么？</h3><p>&emsp;&emsp;Spring Security是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。<br>它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><blockquote>
<p>详细的请看高级篇过滤器详解</p>
</blockquote>
<p>&emsp;&emsp;Spring Security对Web安全性的支持大量地依赖于Servlet过滤器。通过这些过滤器拦截进入请求，判断是否已经登录认证且具访问对应请求的权限,要完成访问控制，Spring Security至少需要下面四个拦截器（调度器、认证管理器、权限资源关联器、访问决策器）进行配合完成.<br>&emsp;&emsp;使用众多的拦截器对url拦截，以此来管理权限，主要讲里面核心流程的两个。 首先，权限管理离不开登陆验证的，所以登陆验证拦截器AuthenticationProcessingFilter要讲； 还有就是对访问的资源管理吧，所以资源管理拦截器AbstractSecurityInterceptor要讲； 但拦截器里面的实现需要一些组件来实现，所以就有了AuthenticationManager、accessDecisionManager等组件来支撑。<br>&emsp;&emsp;现在先大概过一遍整个流程，用户登陆，会被AuthenticationProcessingFilter拦截，调用AuthenticationManager的实现，而且AuthenticationManager会调用ProviderManager来获取用户验证信息（不同的Provider调用的服务不同，因为这些信息可以是在数据库上，可以是在LDAP服务器上，可以是xml配置文件上等），如果验证通过后会将用户的权限信息封装一个User放到spring的全局缓存SecurityContextHolder中，以备后面访问资源时使用。 访问资源（即授权管理），访问url时，会通过AbstractSecurityInterceptor拦截器拦截，其中会调用FilterInvocationSecurityMetadataSource的方法来获取被拦截url所需的全部权限，在调用授权管理器AccessDecisionManager，这个授权管理器会通过spring的全局缓存SecurityContextHolder获取用户的权限信息，还会获取被拦截的url和被拦截url所需的全部权限，然后根据所配的策略（有：一票决定，一票否定，少数服从多数等），如果权限足够，则返回，权限不够则报错并调用权限不足页面。     虽然讲得好像好复杂，读者们可能有点晕，不过不打紧，真正通过代码的讲解在后面，读者可以看完后面的代码实现，再返回看这个简单的原理，可能会有不错的收获。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类:"></a>分类:</h3><p>&emsp;&emsp;总共有四种用法，从简到深为：1、不用数据库，全部数据写在配置文件，这个也是官方文档里面的demo(一般生产环境用不到，仅做参考。)；2、使用数据库，根据spring security默认实现代码设计数据库，也就是说数据库已经固定了，这种方法不灵活，而且那个数据库设计得很简陋，实用性差；3、spring security和Acegi不同，它不能修改默认filter了，但支持插入filter，所以根据这个，我们可以插入自己的filter来灵活使用；4、暴力手段，修改源码，前面说的修改默认filter只是修改配置文件以替换filter而已，这种是直接改了里面的源码，但是这种不符合OO设计原则，而且不实际，不可用。</p>
<h3 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h3><h4 id="1-SecurityContextHolder"><a href="#1-SecurityContextHolder" class="headerlink" title="1 SecurityContextHolder"></a>1 SecurityContextHolder</h4><p>&emsp;&emsp;SecurityContextHolder用于存储安全上下文（security context）的信息。当前操作的用户是谁，该用户是否已经被认证，他拥有哪些角色权限等，这些都被保存在SecurityContextHolder中。SecurityContextHolder默认使用ThreadLocal策略来存储认证信息。看到ThreadLocal 也就意味着，这是一种与线程绑定的策略。Spring Security在用户登录时自动绑定认证信息到当前线程，在用户退出时，自动清除当前线程的认证信息。但这一切的前提，是你在web场景下使用Spring Security，而如果是Swing界面，Spring也提供了支持，SecurityContextHolder的策略则需要被替换，鉴于我的初衷是基于web来介绍Spring Security，所以这里以及后续，非web的相关的内容都一笔带过。</p>
<h5 id="1-1-获取当前用户的信息"><a href="#1-1-获取当前用户的信息" class="headerlink" title="1.1 获取当前用户的信息"></a>1.1 获取当前用户的信息</h5><p>&emsp;&emsp;因为身份信息是与线程绑定的，所以可以在程序的任何地方使用静态方法获取用户信息。一个典型的获取当前登录用户的姓名的<br>例子如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  Object principal = SecurityContextHolder.getContext().getAuthentication().getPrincipal();</span><br><span class="line">  if (principal instanceof UserDetails) &#123;</span><br><span class="line">    String username = ((UserDetails)principal).getUsername();</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    String username = principal.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h5><p>getAuthentication()返回了认证信息，再次getPrincipal()返回了身份信息，UserDetails便是Spring对身份信息封装的一个接口。</p>
<h4 id="2-Authentication"><a href="#2-Authentication" class="headerlink" title="2 Authentication"></a>2 Authentication</h4><p>&emsp;&emsp;先看看这个接口的源码长什么样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package org.springframework.security.core;// &lt;1&gt;</span><br><span class="line">public interface Authentication extends Principal, Serializable &#123; // &lt;1&gt;</span><br><span class="line">    Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); // &lt;2&gt;</span><br><span class="line">    Object getCredentials();// &lt;2&gt;</span><br><span class="line">    Object getDetails();// &lt;2&gt;</span><br><span class="line">    Object getPrincipal();// &lt;2&gt;</span><br><span class="line">    boolean isAuthenticated();// &lt;2&gt;</span><br><span class="line">    void setAuthenticated(boolean var1) throws IllegalArgumentException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Authentication是spring security包中的接口，直接继承自Principal类，而Principal是位于java.security包中的。可以见得，Authentication在spring security中是最高级别的身份/认证的抽象。</li>
<li><p>由这个顶级接口，我们可以得到用户拥有的权限信息列表，密码，用户细节信息，用户身份信息，认证信息。还记得1.1节中，authentication.getPrincipal()返回了一个Object，我们将Principal强转成了Spring Security中最常用的UserDetails，这在Spring Security中非常常见，接口返回Object，使用instanceof判断类型，强转成对应的具体实现类。接口详细解读如下：</p>
<ul>
<li>getAuthorities()，权限信息列表，默认是GrantedAuthority接口的一些实现类，通常是代表权限信息的一系列字符串。</li>
<li>getCredentials()，密码信息，用户输入的密码字符串，在认证过后通常会被移除，用于保障安全。</li>
<li>getDetails()，细节信息，web应用中的实现接口通常为 WebAuthenticationDetails，它记录了访问者的ip地址和sessionId的值。</li>
<li>getPrincipal()，敲黑板！！！最重要的身份信息，大部分情况下返回的是UserDetails接口的实现类，也是框架中的常用接口之一。UserDetails接口将会在下面的小节重点介绍。</li>
</ul>
</li>
</ol>
<h3 id="Spring-Security-身份验证"><a href="#Spring-Security-身份验证" class="headerlink" title="Spring Security 身份验证"></a>Spring Security 身份验证</h3><h4 id="认证过程"><a href="#认证过程" class="headerlink" title="认证过程"></a>认证过程</h4><ol>
<li><p>用户名和密码被过滤器获取到，封装成 Authentication,通常情况下是 UsernamePasswordAuthenticationToken 这个实现类。</p>
</li>
<li><p>AuthenticationManager 身份管理器负责验证这个 Authentication</p>
</li>
<li><p>认证成功后，AuthenticationManager身份管理器返回一个被填充满了信息的（包括上面提到的权限信息，身份信息，细节信息，但密码通常会被移除）Authentication实例。</p>
</li>
<li><p>SecurityContextHolder安全上下文容器将第3步填充了信息的Authentication，通过SecurityContextHolder.getContext().setAuthentication(…)方法，设置到其中。</p>
</li>
</ol>
<h5 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h5><p> 这是一个抽象的认证流程，而整个过程中，如果不纠结于细节，其实只剩下一个AuthenticationManager 是我们没有接触过的了，这个身份管理器我们在后面的小节介绍。将上述的流程转换成代码，便是如下的流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public class AuthenticationExample &#123;</span><br><span class="line">private static AuthenticationManager am = new SampleAuthenticationManager();</span><br><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    BufferedReader in = new BufferedReader(new InputStreamReader(System.in));</span><br><span class="line">    while(true) &#123;</span><br><span class="line">    System.out.println(&quot;Please enter your username:&quot;);</span><br><span class="line">    String name = in.readLine();</span><br><span class="line">    System.out.println(&quot;Please enter your password:&quot;);</span><br><span class="line">    String password = in.readLine();</span><br><span class="line">    try &#123;</span><br><span class="line">        Authentication request = new UsernamePasswordAuthenticationToken(name, password);</span><br><span class="line">        Authentication result = am.authenticate(request);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(result);</span><br><span class="line">        break;</span><br><span class="line">    &#125; catch(AuthenticationException e) &#123;</span><br><span class="line">        System.out.println(&quot;Authentication failed: &quot; + e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;Successfully authenticated.Security context contains:&quot; +</span><br><span class="line">            SecurityContextHolder.getContext().getAuthentication());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class SampleAuthenticationManager implements AuthenticationManager &#123;</span><br><span class="line">  static final List&lt;GrantedAuthority&gt; AUTHORITIES = new ArrayList&lt;GrantedAuthority&gt;();</span><br><span class="line">  static &#123;</span><br><span class="line">      AUTHORITIES.add(new SimpleGrantedAuthority(&quot;ROLE_USER&quot;));</span><br><span class="line">  &#125;</span><br><span class="line">  public Authentication authenticate(Authentication auth) throws AuthenticationException &#123;</span><br><span class="line">      if (auth.getName().equals(auth.getCredentials())) &#123;</span><br><span class="line">      return new UsernamePasswordAuthenticationToken(auth.getName(),</span><br><span class="line">          auth.getCredentials(), AUTHORITIES);</span><br><span class="line">      &#125;</span><br><span class="line">      throw new BadCredentialsException(&quot;Bad Credentials&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><p>上述这段代码只是为了让大家了解Spring Security的工作流程而写的，不是什么源码。在实际使用中，整个流程会变得更加的复杂，但是基本思想，和上述代码如出一辙。</p>
<h4 id="3-AuthenticationManager"><a href="#3-AuthenticationManager" class="headerlink" title="3 AuthenticationManager"></a>3 AuthenticationManager</h4><p>&emsp;&emsp;AuthenticationManager（接口）是认证相关的核心接口，也是发起认证的出发点，因为在实际需求中，我们可能会允许用户使用用户名+密码登录，同时允许用户使用邮箱+密码，手机号码+密码登录，甚至，可能允许用户使用指纹登录（还有这样的操作？没想到吧），所以说AuthenticationManager一般不直接认证，AuthenticationManager接口的常用实现类ProviderManager 内部会维护一个List<authenticationprovider>列表，存放多种认证方式，实际上这是委托者模式的应用（Delegate）。也就是说，核心的认证入口始终只有一个：AuthenticationManager，不同的认证方式：用户名+密码（UsernamePasswordAuthenticationToken），邮箱+密码，手机号码+密码登录则对应了三个AuthenticationProvider。这样一来是不是就好理解多了？熟悉shiro的朋友可以把AuthenticationProvider理解成Realm。在默认策略下，只需要通过一个AuthenticationProvider的认证，即可被认为是登录成功。</authenticationprovider></p>
<blockquote>
<p>AuthenticationManager 内部维护多个AuthenticationProvider，由AuthenticationProvider提供验证信息.</p>
</blockquote>
<blockquote>
<p>统一由AuthenticationManager管理 By author</p>
</blockquote>
<blockquote>
<p>只保留了关键认证部分的ProviderManager源码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">public class ProviderManager implements AuthenticationManager, MessageSourceAware,</span><br><span class="line">        InitializingBean &#123;</span><br><span class="line">    // 维护一个AuthenticationProvider列表</span><br><span class="line">    private List&lt;AuthenticationProvider&gt; providers = Collections.emptyList();</span><br><span class="line"></span><br><span class="line">    public Authentication authenticate(Authentication authentication)</span><br><span class="line">          throws AuthenticationException &#123;</span><br><span class="line">       Class&lt;? extends Authentication&gt; toTest = authentication.getClass();</span><br><span class="line">       AuthenticationException lastException = null;</span><br><span class="line">       Authentication result = null;</span><br><span class="line">       // 依次认证</span><br><span class="line">       for (AuthenticationProvider provider : getProviders()) &#123;</span><br><span class="line">          if (!provider.supports(toTest)) &#123;</span><br><span class="line">             continue;</span><br><span class="line">          &#125;</span><br><span class="line">          try &#123;</span><br><span class="line">             result = provider.authenticate(authentication);</span><br><span class="line">             if (result != null) &#123;</span><br><span class="line">                copyDetails(authentication, result);</span><br><span class="line">                break;</span><br><span class="line">             &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          ...</span><br><span class="line">          catch (AuthenticationException e) &#123;</span><br><span class="line">             lastException = e;</span><br><span class="line">          &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       // 如果有Authentication信息，则直接返回</span><br><span class="line">       if (result != null) &#123;</span><br><span class="line">            if (eraseCredentialsAfterAuthentication</span><br><span class="line">                    &amp;&amp; (result instanceof CredentialsContainer)) &#123;</span><br><span class="line">                 //移除密码</span><br><span class="line">                ((CredentialsContainer) result).eraseCredentials();</span><br><span class="line">            &#125;</span><br><span class="line">             //发布登录成功事件</span><br><span class="line">            eventPublisher.publishAuthenticationSuccess(result);</span><br><span class="line">            return result;</span><br><span class="line">       &#125;</span><br><span class="line">       ...</span><br><span class="line">       //执行到此，说明没有认证成功，包装异常信息</span><br><span class="line">       if (lastException == null) &#123;</span><br><span class="line">          lastException = new ProviderNotFoundException(messages.getMessage(</span><br><span class="line">                &quot;ProviderManager.providerNotFound&quot;,</span><br><span class="line">                new Object[] &#123; toTest.getName() &#125;,</span><br><span class="line">                &quot;No AuthenticationProvider found for &#123;0&#125;&quot;));</span><br><span class="line">       &#125;</span><br><span class="line">       prepareException(lastException, authentication);</span><br><span class="line">       throw lastException;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>&emsp;&emsp; ProviderManager 中的List，会依照次序去认证，认证成功则立即返回，若认证失败则返回null，下一个AuthenticationProvider会继续尝试认证，如果所有认证器都无法认证成功，则ProviderManager 会抛出一个ProviderNotFoundException异常。<br>到这里，如果不纠结于AuthenticationProvider的实现细节以及安全相关的过滤器，认证相关的核心类其实都已经介绍完毕了：身份信息的存放容器SecurityContextHolder，身份信息的抽象Authentication，身份认证器AuthenticationManager及其认证流程。姑且在这里做一个分隔线。下面来介绍下AuthenticationProvider接口的具体实现。</p>
<h5 id="3-1-DaoAuthenticationProvider"><a href="#3-1-DaoAuthenticationProvider" class="headerlink" title="3.1 DaoAuthenticationProvider"></a>3.1 DaoAuthenticationProvider</h5><p>&emsp;&emsp;AuthenticationProvider最常用的一个实现便是DaoAuthenticationProvider。顾名思义，Dao正是数据访问层的缩写，也暗示了这个身份认证器的实现思路。由于本文是一个Overview，姑且只给出其UML类图</p>
<p><img src="http://p4ucv3uvl.bkt.clouddn.com/blog/DaoAuthenticationProvider.png" alt="UML图"></p>
<p>&emsp;&emsp;按照我们最直观的思路，怎么去认证一个用户呢？用户前台提交了用户名和密码，而数据库中保存了用户名和密码，认证便是负责比对同一个用户名，提交的密码和保存的密码是否相同便是了。在Spring Security中。提交的用户名和密码，被封装了UsernamePasswordAuthenticationToken，而根据用户名加载用户的任务则是交给了UserDetailsService，在DaoAuthenticationProvider中，对应的方法便是retrieveUser，虽然有两个参数，但是retrieveUser只有第一个参数起主要作用，返回一个UserDetails。还需要完成UsernamePasswordAuthenticationToken和UserDetails密码的比对，这便是交给additionalAuthenticationChecks方法完成的，如果这个void方法没有抛异常，则认为比对成功。比对密码的过程，用到了PasswordEncoder和SaltSource，密码加密和盐的概念相信不用我赘述了，它们为保障安全而设计，都是比较基础的概念。</p>
<p>&emsp;&emsp;如果你已经被这些概念搞得晕头转向了，不妨这么理解DaoAuthenticationProvider：它获取用户提交的用户名和密码，比对其正确性，如果正确，返回一个数据库中的用户信息（假设用户信息被保存在数据库中）。</p>
<h5 id="3-2-UserDetails与UserDetailsService"><a href="#3-2-UserDetails与UserDetailsService" class="headerlink" title="3.2 UserDetails与UserDetailsService"></a>3.2 UserDetails与UserDetailsService</h5><p>&emsp;&emms;上面不断提到了UserDetails这个接口，它代表了最详细的用户信息，这个接口涵盖了一些必要的用户信息字段，具体的实现类对它进行了扩展。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDetails extends Serializable &#123;</span><br><span class="line">   Collection&lt;? extends GrantedAuthority&gt; getAuthorities();</span><br><span class="line">   String getPassword();</span><br><span class="line">   String getUsername();</span><br><span class="line">   boolean isAccountNonExpired();</span><br><span class="line">   boolean isAccountNonLocked();</span><br><span class="line">   boolean isCredentialsNonExpired();</span><br><span class="line">   boolean isEnabled();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emms;它和Authentication接口很类似，比如它们都拥有username，authorities，区分他们也是本文的重点内容之一。Authentication的getCredentials()与UserDetails中的getPassword()需要被区分对待，前者是用户提交的密码凭证，后者是用户正确的密码，认证器其实就是对这两者的比对。Authentication中的getAuthorities()实际是由UserDetails的getAuthorities()传递而形成的。还记得Authentication接口中的getUserDetails()方法吗？其中的UserDetails用户详细信息便是经过了AuthenticationProvider之后被填充的.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDetailsService &#123;</span><br><span class="line">   UserDetails loadUserByUsername(String username) throws UsernameNotFoundException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;UserDetailsService和AuthenticationProvider两者的职责常常被人们搞混，关于他们的问题在文档的FAQ和issues中屡见不鲜。记住一点即可，敲黑板！！！UserDetailsService只负责从特定的地方（通常是数据库）加载用户信息，仅此而已，记住这一点，可以避免走很多弯路。UserDetailsService常见的实现类有JdbcDaoImpl，InMemoryUserDetailsManager，前者从数据库加载用户，后者从内存中加载用户，也可以自己实现UserDetailsService，通常这更加灵活。</p>
<h4 id="4-整体架构图"><a href="#4-整体架构图" class="headerlink" title="4 整体架构图"></a>4 整体架构图</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://p4ucv3uvl.bkt.clouddn.com/blog/blog/structure.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="二-代码篇"><a href="#二-代码篇" class="headerlink" title="二 代码篇"></a>二 代码篇</h2><p><a href="https://github.com/spring-projects/spring-security/tree/master/samples/boot/helloworld" target="_blank" rel="noopener">入门例子</a></p>
<h3 id="核心配置"><a href="#核心配置" class="headerlink" title="核心配置"></a>核心配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">  @Override</span><br><span class="line">  protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">      http</span><br><span class="line">          .authorizeRequests()</span><br><span class="line">              .antMatchers(&quot;/&quot;, &quot;/home&quot;).permitAll()</span><br><span class="line">              .anyRequest().authenticated()</span><br><span class="line">              .and()</span><br><span class="line">          .formLogin()</span><br><span class="line">              .loginPage(&quot;/login&quot;)</span><br><span class="line">              .permitAll()</span><br><span class="line">              .and()</span><br><span class="line">          .logout()</span><br><span class="line">              .permitAll();</span><br><span class="line">  &#125;</span><br><span class="line">  @Autowired</span><br><span class="line">  public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">    // 内存中配置admin用户，密码admin，角色USER</span><br><span class="line">      auth</span><br><span class="line">          .inMemoryAuthentication()</span><br><span class="line">              .withUser(&quot;admin&quot;).password(&quot;admin&quot;).roles(&quot;USER&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h5><p>&emsp;&emsp;当配置了上述的javaconfig之后，我们的应用便具备了如下的功能：</p>
<ul>
<li>除了“/”,”/home”(首页),”/login”(登录),”/logout”(注销),之外，其他路径都需要认证。</li>
<li>指定“/login”该路径为登录页面，当未认证的用户尝试访问任何受保护的资源时，都会跳转到“/login”。</li>
<li>默认指定“/logout”为注销页面</li>
<li>配置一个内存中的用户认证器，使用admin/admin作为用户名和密码，具有USER角色</li>
<li>防止CSRF攻击</li>
<li>Session Fixation protection(可以参考我之前讲解Spring Session的文章，防止别人篡改sessionId)</li>
<li>Security Header(添加一系列和Header相关的控制)</li>
<li>HTTP Strict Transport Security for secure requests</li>
<li>集成X-Content-Type-Options</li>
<li>缓存控制</li>
<li>集成X-XSS-Protection.aspx)</li>
<li>X-Frame-Options integration to help prevent Clickjacking(iframe被默认禁止使用)</li>
<li>为Servlet API集成了如下的几个方法</li>
<li>HttpServletRequest#getRemoteUser())</li>
<li>HttpServletRequest.html#getUserPrincipal())</li>
<li>HttpServletRequest.html#isUserInRole(java.lang.String))</li>
<li>HttpServletRequest.html#login(java.lang.String, java.lang.String))</li>
<li>HttpServletRequest.html#logout())</li>
</ul>
<h4 id="注解-EnableWebSecurity"><a href="#注解-EnableWebSecurity" class="headerlink" title="注解 @EnableWebSecurity"></a>注解 @EnableWebSecurity</h4><p>我们自己定义的配置类WebSecurityConfig加上了@EnableWebSecurity注解，同时继承了WebSecurityConfigurerAdapter。你可能会在想谁的作用大一点，毫无疑问@EnableWebSecurity起到决定性的配置作用，它其实是个组合注解。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Import(&#123; WebSecurityConfiguration.class, // &lt;2&gt;</span><br><span class="line">      SpringWebMvcImportSelector.class &#125;) // &lt;1&gt;</span><br><span class="line">@EnableGlobalAuthentication // &lt;3&gt;</span><br><span class="line">@Configuration</span><br><span class="line">public @interface EnableWebSecurity &#123;</span><br><span class="line">   boolean debug() default false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>@Import是springboot提供的用于引入外部的配置的注解，可以理解为：@EnableWebSecurity注解激活了@Import注解中包含的配置类。</p>
</li>
<li><p>SpringWebMvcImportSelector的作用是判断当前的环境是否包含springmvc，因为spring security可以在非spring环境下使用，为了避免DispatcherServlet的重复配置，所以使用了这个注解来区分。</p>
</li>
<li><p>WebSecurityConfiguration顾名思义，是用来配置web安全的，下面的小节会详细介绍。</p>
</li>
<li><p>@EnableGlobalAuthentication注解的源码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Import(AuthenticationConfiguration.class)</span><br><span class="line">@Configuration</span><br><span class="line">public @interface EnableGlobalAuthentication &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意点同样在@Import之中，它实际上激活了AuthenticationConfiguration这样的一个配置类，用来配置认证相关的核心类。也就是说，@EnableWebSecurity完成的工作便是加载了WebSecurityConfiguration，AuthenticationConfiguration这两个核心配置类，也就此将spring security的职责划分为了配置安全信息，配置认证信息两部分。</p>
<h4 id="WebSecurityConfiguration"><a href="#WebSecurityConfiguration" class="headerlink" title="WebSecurityConfiguration"></a>WebSecurityConfiguration</h4><p>在这个配置类中，有一个非常重要的Bean被注册了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebSecurityConfiguration &#123;</span><br><span class="line">	//DEFAULT_FILTER_NAME = &quot;springSecurityFilterChain&quot;</span><br><span class="line">	@Bean(name = AbstractSecurityWebApplicationInitializer.DEFAULT_FILTER_NAME)</span><br><span class="line">    public Filter springSecurityFilterChain() throws Exception &#123;</span><br><span class="line">    	...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>在未使用springboot之前，大多数人都应该对“springSecurityFilterChain”这个名词不会陌生，他是spring security的核心过滤器，是整个认证的入口。在曾经的XML配置中，想要启用spring security，需要在web.xml中进行如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Spring Security --&gt;</span><br><span class="line">   &lt;filter&gt;</span><br><span class="line">       &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;</span><br><span class="line">       &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;</span><br><span class="line">   &lt;/filter&gt;</span><br><span class="line">   &lt;filter-mapping&gt;</span><br><span class="line">       &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;</span><br><span class="line">       &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">   &lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure>
<h4 id="AuthenticationConfiguration"><a href="#AuthenticationConfiguration" class="headerlink" title="AuthenticationConfiguration"></a>AuthenticationConfiguration</h4><p>而在springboot集成之后，这样的XML被java配置取代。WebSecurityConfiguration中完成了声明springSecurityFilterChain的作用，并且最终交给DelegatingFilterProxy这个代理类，负责拦截请求（注意DelegatingFilterProxy这个类不是spring security包中的，而是存在于web包中，spring使用了代理模式来实现安全过滤的解耦）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@Import(ObjectPostProcessorConfiguration.class)</span><br><span class="line">public class AuthenticationConfiguration &#123;</span><br><span class="line">  	@Bean</span><br><span class="line">	public AuthenticationManagerBuilder authenticationManagerBuilder(</span><br><span class="line">			ObjectPostProcessor&lt;Object&gt; objectPostProcessor) &#123;</span><br><span class="line">		return new AuthenticationManagerBuilder(objectPostProcessor);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">  	public AuthenticationManager getAuthenticationManager() throws Exception &#123;</span><br><span class="line">    	...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AuthenticationConfiguration的主要任务，便是负责生成全局的身份认证管理者AuthenticationManager。还记得在《Spring Security(一) 基础篇》中，介绍了Spring Security的认证体系，AuthenticationManager便是最核心的身份认证管理器。</p>
<h4 id="WebSecurityConfigurerAdapter"><a href="#WebSecurityConfigurerAdapter" class="headerlink" title="WebSecurityConfigurerAdapter"></a>WebSecurityConfigurerAdapter</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://p4ucv3uvl.bkt.clouddn.com/blog/WebSecurityConfigurerAdapter.png" alt="WebSecurityConfigurerAdapter" title="">
                </div>
                <div class="image-caption">WebSecurityConfigurerAdapter</div>
            </figure>
<p>由参数就可以知道，分别是对AuthenticationManagerBuilder，WebSecurity，HttpSecurity进行个性化的配置。</p>
<h5 id="HttpSecurity常用配置"><a href="#HttpSecurity常用配置" class="headerlink" title="HttpSecurity常用配置"></a>HttpSecurity常用配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">public class CustomWebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                .antMatchers(&quot;/resources/**&quot;, &quot;/signup&quot;, &quot;/about&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)</span><br><span class="line">                .antMatchers(&quot;/db/**&quot;).access(&quot;hasRole(&apos;ADMIN&apos;) and hasRole(&apos;DBA&apos;)&quot;)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">                .usernameParameter(&quot;username&quot;)</span><br><span class="line">                .passwordParameter(&quot;password&quot;)</span><br><span class="line">                .failureForwardUrl(&quot;/login?error&quot;)</span><br><span class="line">                .loginPage(&quot;/login&quot;)</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">            .logout()</span><br><span class="line">                .logoutUrl(&quot;/logout&quot;)</span><br><span class="line">                .logoutSuccessUrl(&quot;/index&quot;)</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">            .httpBasic()</span><br><span class="line">                .disable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述是一个使用Java Configuration配置HttpSecurity的典型配置，其中http作为根开始配置，每一个and()对应了一个模块的配置（等同于xml配置中的结束标签），并且and()返回了HttpSecurity本身，于是可以连续进行配置。他们配置的含义也非常容易通过变量本身来推测，</p>
<ul>
<li>authorizeRequests()配置路径拦截，表明路径访问所对应的权限，角色，认证信息。</li>
<li>formLogin()对应表单认证相关的配置</li>
<li>logout()对应了注销相关的配置</li>
<li>httpBasic()可以配置basic登录</li>
<li>etc</li>
</ul>
<p>他们分别代表了http请求相关的安全配置，这些配置项无一例外的返回了Configurer类，而所有的http相关配置可以通过查看 HttpSecurity 的主要方法得知：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://p4ucv3uvl.bkt.clouddn.com/blog/HttpSecurity.png" alt="HttpSecurity" title="">
                </div>
                <div class="image-caption">HttpSecurity</div>
            </figure>
<p>需要对http协议有一定的了解才能完全掌握所有的配置，不过，springboot和spring security的自动配置已经足够使用了。其中每一项Configurer（e.g.FormLoginConfigurer,CsrfConfigurer）都是HttpConfigurer的细化配置项。</p>
<h4 id="WebSecurityBuilder"><a href="#WebSecurityBuilder" class="headerlink" title="WebSecurityBuilder"></a>WebSecurityBuilder</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void configure(WebSecurity web) throws Exception &#123;</span><br><span class="line">        web</span><br><span class="line">            .ignoring()</span><br><span class="line">            .antMatchers(&quot;/resources/**&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="AuthenticationManagerBuilder"><a href="#AuthenticationManagerBuilder" class="headerlink" title="AuthenticationManagerBuilder"></a>AuthenticationManagerBuilder</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        auth</span><br><span class="line">            .inMemoryAuthentication()</span><br><span class="line">            .withUser(&quot;admin&quot;).password(&quot;admin&quot;).roles(&quot;USER&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>想要在 WebSecurityConfigurerAdapter 中进行认证相关的配置，可以使用 configure(AuthenticationManagerBuilder auth) 暴露一个 AuthenticationManager 的建造器：AuthenticationManagerBuilder 。如上所示，我们便完成了内存中用户的配置。</p>
<blockquote>
<p>有待考证 TODO</p>
</blockquote>
<p>如果你的应用只有唯一一个WebSecurityConfigurerAdapter，那么他们之间的差距可以被忽略，从方法名可以看出两者的区别：使用@Autowired注入的AuthenticationManagerBuilder是全局的身份认证器，作用域可以跨越多个WebSecurityConfigurerAdapter，以及影响到基于Method的安全控制；而 protected configure()的方式则类似于一个匿名内部类，它的作用域局限于一个WebSecurityConfigurerAdapter内部。关于这一点的区别，可以参考我曾经提出的issuespring-security#issues4571。官方文档中，也给出了配置多个WebSecurityConfigurerAdapter的场景以及demo，将在该系列的后续文章中解读</p>
<h2 id="三-高级篇"><a href="#三-高级篇" class="headerlink" title="三 高级篇"></a>三 高级篇</h2><hr>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><h4 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h4><p>&emsp;&emsp;Servlet过滤器被用来拦截用户请求来进行请求之前或之后的处理，或者干脆重定向这个请求，这取决于servlet过滤器的功能。</p>
<p>Servlet过滤器处理之后的目标servlet是 MVC 分发web servlet。</p>
<p>servlet请求按照一定的顺序从一个过滤器到下一个穿过整个过滤器链，最终到达目标servlet。与之相对的是，当servelt处理完请求并返回一个response时，过滤器链按照相反的顺序再线性次穿过所有的过滤器。</p>
<h4 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h4><p>&emsp;&emsp;Spring Security利用Spring在XML配置文件中的自动配置属性，建立了十个servlet过滤器，这些过滤器并没有配置在web.xml中，而是由Spring Factory使用JavaEE的servlet过滤器链将他们按顺序组装。</p>
<p>Spring Security使用了过滤器链的实现了自己的抽象，提供了VirtualFilterChain，它可以根据Spring Security XML配置文件中设置的URL模式动态的创建过滤器链（可以将它与标准的Java EE过滤器链进行对比，后者需要在web应用的部署描述文件中进行设置）。</p>
<p>&emsp;&emsp;Spring Security的自动配置选项auto-config为你建立了十个Spring Security的过滤器。这些过滤器以及它们使用的顺序，在下面的表格中进行了描述。</p>
<p>如：UsernamePasswordAuthenticationFilter是通过<http>配置指令的<form-login>子元素来进行配置的。</form-login></http></p>
<table>
<thead>
<tr>
<th style="text-align:left">过滤器名称</th>
<th style="text-align:center">描述</th>
<th style="text-align:right">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SecurityContextPersistenceFilter</td>
<td style="text-align:center">负责从SecurityContextRepository获取或存储SecurityContext。SecurityContext代表了用户安全和认证过的session。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">LogoutFilter</td>
<td style="text-align:center">监控一个实际为退出功能的URL（默认为/j_spring_security_logout），并且在匹配的时候完成用户的退出功能。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">UsernamePasswordAuthenticationFilter</td>
<td style="text-align:center">监控一个使用用户名和密码基于form认证的URL（默认为/j_spring_security_check），并在URL匹配的情况下尝试认证该用户。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">DefaultLoginPageGeneratingFilter</td>
<td style="text-align:center">监控一个要进行基于forn或OpenID认证的URL（默认为/spring_security_login），并生成展现登录form的HTML</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">BasicAuthenticationFilter</td>
<td style="text-align:center">监控HTTP 基础认证的头信息并进行处理</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">RequestCacheAwareFilter</td>
<td style="text-align:center">用于用户登录成功后，重新恢复因为登录被打断的请求。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">SecurityContextHolderAwareRequestFilter</td>
<td style="text-align:center">用一个扩展了HttpServletRequestWrapper的子类（o.s.s.web.servletapi.SecurityContextHolderAwareRequestWrapper）包装HttpServletRequest。它为请求处理器提供了额外的上下文信息。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">AnonymousAuthenticationFilter</td>
<td style="text-align:center">如果用户到这一步还没有经过认证，将会为这个请求关联一个认证的token，标识此用户是匿名的。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">SessionManagementFilter</td>
<td style="text-align:center">根据认证的安全实体信息跟踪session，保证所有关联一个安全实体的session都能被跟踪到。</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">ExceptionTranslationFilter</td>
<td style="text-align:center">解决在处理一个请求时产生的指定异常</td>
<td style="text-align:right"></td>
</tr>
<tr>
<td style="text-align:left">FilterSecurityInterceptor</td>
<td style="text-align:center">简化授权和访问控制决定，委托一个AccessDecisionManager完成授权的判断</td>
</tr>
</tbody>
</table>
<p>重要的过滤器<br>|过滤器名称|描述|说明|<br>|-|-|-|<br>|AbstractAuthenticationProcessingFilter|认证进程过滤器||<br>||||</p>
<h2 id="四-使用-Spring-Security"><a href="#四-使用-Spring-Security" class="headerlink" title="四 使用 Spring Security"></a>四 使用 Spring Security</h2><h3 id="Spring-Boot-使用-Spring-Security"><a href="#Spring-Boot-使用-Spring-Security" class="headerlink" title="Spring Boot 使用 Spring Security"></a>Spring Boot 使用 Spring Security</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring security依赖 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="相关参考网址"><a href="#相关参考网址" class="headerlink" title="相关参考网址"></a>相关参考网址</h2><p><a href="http://www.importnew.com/26712.html" target="_blank" rel="noopener">参考</a><br><br><a href="https://springcloud.cc/spring-security-zhcn.html" target="_blank" rel="noopener">官方文档 - 中文翻译</a><br><br><a href="http://www.cnblogs.com/SmallTalker/p/7851848.html" target="_blank" rel="noopener">Spring boot中Spring Security 使用5部曲</a><br><br><a href="http://www.360doc.com/content/10/0422/11/15643_24320208.shtml" target="_blank" rel="noopener">Spring Security 11种过滤器介绍</a><br><br><a href="https://www.cnblogs.com/lexiaofei/p/7059966.html" target="_blank" rel="noopener">Spring Security过滤器机制</a><br><br><a href="https://www.hellojava.com/article/815" target="_blank" rel="noopener">参考</a><br>[Spring Security(四)–核心过滤器源码分析]（<a href="http://blog.didispace.com/xjf-spring-security-4/）" target="_blank" rel="noopener">http://blog.didispace.com/xjf-spring-security-4/）</a><br><a href="http://www.cnblogs.com/final-elysion/p/6074572.html" target="_blank" rel="noopener">spring mvc参考</a><br><a href="https://www.cnblogs.com/linhp/p/5817054.html" target="_blank" rel="noopener">FilterInvocationSecurityMetadataSource</a><br><a href="http://www.cnblogs.com/fenglan/category/887982.html" target="_blank" rel="noopener">spring security</a><br><a href="http://www.baeldung.com/spring-security-custom-configurer" target="_blank" rel="noopener">Custom Configurer</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新：<time datetime="2018-03-14T15:31:17.836Z" itemprop="dateUpdated">2018-03-14 23:31:17</time>
</span>


        
        原文链接：<a href="/2018/03/14/spring-security/" target="_blank" rel="external">http://yoursite.com/2018/03/14/spring-security/</a>
        
    </div>
    <footer>
        <div onclick="location.href='http://yoursite.com'">
            <img src="/img/picture.jpg" alt="joke">
            <a>joke</a>
        </div>
    </footer>
</blockquote>

        
    <div class="page-reward">
        <nav class="myreward">
            <a id="rewardBtn" href="javascript:;"><span>打&nbsp;赏</span><span>谢谢您的奖励</span></a>
        </nav>
    </div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2018/03/14/spring-security/&title=《Spring Security based on Spring Boot》 — 个人空间&pic=http://yoursite.com/img/picture.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2018/03/14/spring-security/&title=《Spring Security based on Spring Boot》 — 个人空间&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2018/03/14/spring-security/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Spring Security based on Spring Boot》 — 个人空间&url=http://yoursite.com/2018/03/14/spring-security/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2018/03/14/spring-security/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/03/14/springboot-debug/" id="post-next" class="post-nav-link">
        <h4 class="title" data-hover="下一篇：Spring Boot 远程调试">下一篇：Spring Boot 远程调试</h4>
      </a>
    </div>
  
</nav>



    
    
<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'hou68',
            repo: 'hou68.github.io',
            oauth: {
                client_id: '580138edff8e2e068ed1',
                client_secret: 'b21cfc5b3a678bbb24c9eba25b38d0ddf6ad2975',
            },
        })
        gitment.render('comments')
    </script>
</section>


    

    
    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "",
            appKey: "",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->



</article>

</div>

        <footer class="footer">
    <div class="footer-content">
        <span class="power">
            <i class="icon icon-lg icon-copyright"></i>
            2017
            <i class="icon icon-lg icon-heart"></i>
            <a href="http://yoursite.com">tomotoes.com</a>
            <br/>
            Power by
            <a href="https://hexo.io/" target="_blank" rel="external nofollow">Hexo</a>&nbsp;·&nbsp;
            Theme
            <a class="tomotoeslink" href="https://github.com/tomotoes/hexo-theme-tomotoes/" target="_blank" rel="external nofollow">tomotoes</a>
        </span>

        <br/>

        <span id="RunTime" style="color:#a7a7a2;"></span>
        <br/>

        <span>
            
	<i class="icon icon-lg icon-user">
<span id="busuanzi_container_site_uv" style='display:none'>
       访问用户：<span id="busuanzi_value_site_uv"></span>
    </span>人</i>
    ·
    <i class="icon icon-lg icon-eye">
    <span id="busuanzi_container_site_pv" style='display:none'>
      访问次数：<span id="busuanzi_value_site_pv"></span>
    </span>次
    </i>


        </span>
        <br/>

        <span class="license"><a  target="_blank" rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">博客内容遵循 知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
    </div>
</footer>

    </main>
    
        
<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        <span>感谢您的鼓励支持！</span>
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" data-img="/img/dog.png" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.png" data-alipay="/img/alipay.png">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechatPay">&nbsp;&nbsp;微信&nbsp;&nbsp;</span>
                <span class="reward-toggle-item alipayPay">支付宝</span>
            </div>
        </label>
        
        <i class="icon icon-caret-up"></i>
    </div>
</div>


    
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2018/03/14/spring-security/&title=《Spring Security based on Spring Boot》 — 个人空间&pic=http://yoursite.com/img/picture.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2018/03/14/spring-security/&title=《Spring Security based on Spring Boot》 — 个人空间&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2018/03/14/spring-security/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Spring Security based on Spring Boot》 — 个人空间&url=http://yoursite.com/2018/03/14/spring-security/&via=http://yoursite.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://yoursite.com/2018/03/14/spring-security/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p class="wechatshare">扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLUlEQVR42u3aQW4DMQgF0Nz/0u22VRvngyeRBr9ZRY1T+80CYeDxiJ+v+Fmv//ntepfHOx4MDIzbMnaOtf7V30Ov11T3xcDAOI3xLIKt16z/TxJwk2+TvTAwMDCSQ6zD5RqWkDAwMDB2Au768vkipcPAwMCIGXmBrHfp3UkiL76LY2Bg3JCRV90///kt/Q0MDIxbMd5R7s/Tu/yi++JUGBgYoxnVon81yas2ErbOg4GBcQBjJ+Ql19fqmvKgGAYGxlBGr7lYTf6SkF0t+f36CwYGxjGMndGuZqQvlvme7oKBgTGa0Rue6DUM8he08ysMDIzZjPV1NOkbJoCd9RfcyDEwMEYwqkX/ZJs8obygOYqBgTGOUT1oDk5Kab3yXOEujoGBMYJRTROr6do72gAXZLsYGBg3ZPTSsurh8mGLPKBjYGCcwEgCa6+i1Wse5Gf75xKLgYFxGKPajOyF3Z1LbLmngYGBMYhRDbU7YxZ5K/TFVRYDA2M0o/mDOHXrBfe8SFd4xxgYGCMYvUP30sGrCm3/BFwMDIzRjGrPMzloNRAn4Ki/gYGBMZTRO8rOEEZOjUgYGBhDGb30rrqmFyELVAwMjNGM/Nkfy6iW/vOBDAwMjBMYeQCtvpWPBlwMDIwDGHng64XFQom/WBzEwMDAqJbD8pZDL1g3Z0YwMDCOZOxvn7cnozEODAyMAxjVZkDStswHxfaboBgYGLMZ1atjdVy1d9CrRjQwMDBuzvgGp+qyUD4/ra0AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <!-- waves按钮特效 -->
<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<!-- 主题配置脚本 -->
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };
</script>

<!-- jquery -->
<script src="/js/jquery.min.js?v=3.0"></script>

<!-- 搜索 -->

<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item waves-block waves-effect" onclick="location.href='{path}'">
    <div class="title ellipsis" title="{title}">{title}</div>
</li>
</template>


<!-- main博客脚本 -->
<script src="/js/main.min.js?v=3.0" ></script>

<!-- 动画&配置 -->
<script src="/js/script.min.js?v=3.0" ></script>

<!-- 脚本管理 -->
<script>

if(window.innerWidth > 800){
	/* 3D标题 */
	$(".content-header").on("mousemove", threedee);

	/* 底部追随鼠标 */
	$(".footer").hover(2);

	/* gotop键的涟漪 */
	$("#gotop").hover(1);

	/* 赞赏的粒子雨 */
	$("#reward").hover(3);

	/* 微信公众号的底部渲染 */
	$("#wechat").hover(4);

    /* 标题跳动 */
    $(".archivestitle").bumpyText();

	/* 图片点击放大 */
	const postimg = jQuery(".post-content img:not(.github-emoji)");
	postimg.on("click",function(){

		mask.classList.add("in");
		main.classList.add("Mask");
		menu.classList.add("Mask");
		var myimg = this.cloneNode(true);
		myimg.classList.add("imgShow");

		setTimeout(function(){
			jQuery(myimg).animate({
				opacity:"1"
			},1000);
		},0);

		document.body.appendChild(myimg);

		myimg.onclick=function(){
			document.body.removeChild(myimg);
			mask.classList.remove("in");
			main.classList.remove("Mask");
			menu.classList.remove("Mask");
		};

	});

}

/* 名字跳动 */
$("#name").bumpyText();


/* 网站运行时间 */
setInterval(function () {
	setTime("2017/10/11");
}, 1000);

/* 文章块的淡出 */
postshow();

/* 座右铭 */

   getHitokoto();



/* 粘贴提示 */
G($(".post-content"), location.href, "joke");


/* 控制台 */
if (window.console && window.console.log) {
	setTimeout(function () {
		console.log("\n %c 一个坏掉的番茄 %c  © Simon Ma  http://tomotoes.com \n\n", "color:#FFFFFB;background:#1abc9c;padding:5px 0;border-radius:.5rem 0 0 .5rem;", "color:#FFFFFB;background:#080808;padding:5px 0;border-radius:0 .5rem .5rem 0;");
	}, 0);
}

</script>




<!-- 公式渲染 -->



<!-- 不蒜子 -->

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script>


</body>
</html>
